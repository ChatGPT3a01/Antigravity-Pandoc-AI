# 進階技巧速查表

## 效能優化

### 測量執行時間
```powershell
Measure-Command { pandoc input.md -o output.docx }
```

### 平行處理 (PowerShell 7+)
```powershell
Get-ChildItem *.md | ForEach-Object -Parallel {
    pandoc $_.FullName -o ($_.BaseName + ".docx")
} -ThrottleLimit 4
```

### 只處理變更的檔案
```powershell
Get-ChildItem *.md | Where-Object {
    $output = $_.BaseName + ".docx"
    !(Test-Path $output) -or $_.LastWriteTime -gt (Get-Item $output).LastWriteTime
} | ForEach-Object {
    pandoc $_.FullName -o ($_.BaseName + ".docx")
}
```

---

## 錯誤處理

### 基本 Try-Catch
```powershell
try {
    pandoc input.md -o output.docx -ErrorAction Stop
} catch {
    Write-Host "錯誤: $_" -ForegroundColor Red
}
```

### 檢查檔案存在
```powershell
if (!(Test-Path $inputFile)) {
    Write-Host "錯誤: 檔案不存在" -ForegroundColor Red
    exit 1
}
```

### 驗證輸出檔案
```powershell
if ((Test-Path $outputFile) -and (Get-Item $outputFile).Length -gt 0) {
    Write-Host "轉換成功" -ForegroundColor Green
} else {
    Write-Host "轉換可能失敗" -ForegroundColor Yellow
}
```

### 日誌記錄
```powershell
function Write-Log {
    param($Message, $Level = "INFO")
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    "[$timestamp] [$Level] $Message" | Out-File "log.txt" -Append
}
```

---

## 工作流程整合

### 資料夾監控
```powershell
$watcher = New-Object System.IO.FileSystemWatcher
$watcher.Path = "D:\待處理"
$watcher.Filter = "*.md"
$watcher.EnableRaisingEvents = $true

Register-ObjectEvent $watcher "Created" -Action {
    $file = $Event.SourceEventArgs.FullPath
    pandoc $file -o ($file -replace '\.md$', '.docx')
}
```

### 排程任務
```powershell
$action = New-ScheduledTaskAction -Execute "PowerShell.exe" `
    -Argument "-File D:\Scripts\convert.ps1"
$trigger = New-ScheduledTaskTrigger -Daily -At "09:00"
Register-ScheduledTask -TaskName "每日轉換" -Action $action -Trigger $trigger
```

### 桌面通知
```powershell
$shell = New-Object -ComObject WScript.Shell
$shell.Popup("處理完成！", 5, "通知", 64)
```

---

## 常見錯誤與解決

| 錯誤訊息 | 原因 | 解決方法 |
|---------|------|---------|
| `does not exist` | 檔案不存在 | 檢查路徑拼寫 |
| `Could not parse YAML` | YAML 格式錯誤 | 檢查 `---` 標記和縮排 |
| `invalid byte sequence` | 編碼問題 | 轉存為 UTF-8 |
| `pdflatex not found` | 缺少 LaTeX | 安裝 MiKTeX |
| `Could not find image` | 圖片路徑錯誤 | 使用正確的相對路徑 |

---

## 除錯技巧

### 顯示詳細資訊
```powershell
pandoc input.md -o output.docx --verbose
```

### 檢查檔案編碼
```powershell
$bytes = [System.IO.File]::ReadAllBytes("file.md")
if ($bytes[0] -eq 0xEF) { "UTF-8 with BOM" }
```

### 分步驟測試
1. 先測試 → HTML（最簡單）
2. 成功後 → DOCX
3. 最後 → PDF（最複雜）

---

## 實用參數組合

### 高效能批次轉換
```powershell
pandoc input.md -o output.docx --quiet
```

### 最小輸出（無樣式）
```powershell
pandoc input.md -o output.html --no-highlight
```

### 獨立 HTML（包含所有資源）
```powershell
pandoc input.md -o output.html --standalone --self-contained
```

---

*建立日期：2024*
